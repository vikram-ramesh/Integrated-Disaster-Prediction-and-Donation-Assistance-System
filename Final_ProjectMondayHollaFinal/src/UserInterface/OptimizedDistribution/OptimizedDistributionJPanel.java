/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package UserInterface.OptimizedDistribution;

/**
 *
 * @author mansi
 */
import Business.Enterprise.Enterprise;
import Business.Organization.ManagmentOrganization;
import Business.Organization.Organization;
import Business.Person.Person;
import Business.Role.DriverRole;
import Business.Role.Role;
import Business.UserAccount.UserAccount;
import DynamicDijsktars.Dijkstra;
import DynamicDijsktars.Graph;
import DynamicDijsktars.Vertex;
import java.awt.CardLayout;
import java.awt.Graphics;
import java.awt.Image;
import java.awt.image.ImageObserver;
import java.awt.image.ImageProducer;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.HashSet;
import java.util.LinkedList;
import java.util.Map;
import java.util.Set;
import java.util.logging.Level;
import java.util.logging.Logger;
import javax.swing.ImageIcon;
import javax.swing.JOptionPane;
import javax.swing.JPanel;
import javax.swing.table.DefaultTableModel;

public class OptimizedDistributionJPanel extends javax.swing.JPanel {

    /**
     * Creates new form OptimizedDistributionJPanel
     */
    private Dijkstra dijkstra;
    private JPanel UserProcessContainer;
    private Enterprise enterprise;

    private UserAccount useraccount;
    private ManagmentOrganization managementOrganization;

    HashMap< Integer, LinkedList<Vertex>> driverPathMap = new HashMap<Integer, LinkedList<Vertex>>();

    public OptimizedDistributionJPanel(JPanel UserProcessContainer, Enterprise enterprise, UserAccount useraccount, Organization organization) throws Exception {
        initComponents();

        this.dijkstra = new Dijkstra();

        System.out.println("Dijkstra  object " + dijkstra);
        int size = 5;
        dijkstra.create(size);  //graph made
        System.out.println("Graph Object" + dijkstra.getG());
        dijkstra.calculate(dijkstra.getG().getVertex(0));  //g.getVertex(0)

        dijkstra.printPath(dijkstra.getG());
        populateTable(dijkstra.getG());

        this.UserProcessContainer = UserProcessContainer;
        this.enterprise = enterprise;
        this.useraccount = useraccount;

        this.managementOrganization = (ManagmentOrganization) organization;

    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        v0 = new javax.swing.JButton();
        v1 = new javax.swing.JButton();
        v4 = new javax.swing.JButton();
        v2 = new javax.swing.JButton();
        v3 = new javax.swing.JButton();
        jScrollPane1 = new javax.swing.JScrollPane();
        shortestPathTbl = new javax.swing.JTable();
        btnAssignDriver = new javax.swing.JButton();
        backJButton = new javax.swing.JButton();

        setBackground(new java.awt.Color(255, 255, 255));
        setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(0, 0, 0)));
        setLayout(new org.netbeans.lib.awtextra.AbsoluteLayout());

        v0.setIcon(new javax.swing.ImageIcon(getClass().getResource("/UserInterface/animated-lighthouse-image-0001.gif"))); // NOI18N
        v0.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                v0ActionPerformed(evt);
            }
        });
        add(v0, new org.netbeans.lib.awtextra.AbsoluteConstraints(20, 300, 100, 80));

        v1.setIcon(new javax.swing.ImageIcon(getClass().getResource("/UserInterface/animated-lighthouse-image-0001.gif"))); // NOI18N
        v1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                v1ActionPerformed(evt);
            }
        });
        add(v1, new org.netbeans.lib.awtextra.AbsoluteConstraints(150, 190, 100, 80));

        v4.setIcon(new javax.swing.ImageIcon(getClass().getResource("/UserInterface/animated-lighthouse-image-0001.gif"))); // NOI18N
        add(v4, new org.netbeans.lib.awtextra.AbsoluteConstraints(160, 400, 100, 80));

        v2.setIcon(new javax.swing.ImageIcon(getClass().getResource("/UserInterface/animated-lighthouse-image-0001.gif"))); // NOI18N
        v2.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                v2ActionPerformed(evt);
            }
        });
        add(v2, new org.netbeans.lib.awtextra.AbsoluteConstraints(360, 190, 100, 80));

        v3.setIcon(new javax.swing.ImageIcon(getClass().getResource("/UserInterface/animated-lighthouse-image-0001.gif"))); // NOI18N
        add(v3, new org.netbeans.lib.awtextra.AbsoluteConstraints(370, 400, 100, 80));

        shortestPathTbl.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {

            },
            new String [] {
                "Shortest path", "Shortest path", "Distance"
            }
        ) {
            boolean[] canEdit = new boolean [] {
                false, false, false
            };

            public boolean isCellEditable(int rowIndex, int columnIndex) {
                return canEdit [columnIndex];
            }
        });
        jScrollPane1.setViewportView(shortestPathTbl);
        if (shortestPathTbl.getColumnModel().getColumnCount() > 0) {
            shortestPathTbl.getColumnModel().getColumn(0).setMinWidth(0);
            shortestPathTbl.getColumnModel().getColumn(0).setPreferredWidth(0);
            shortestPathTbl.getColumnModel().getColumn(0).setMaxWidth(0);
        }

        add(jScrollPane1, new org.netbeans.lib.awtextra.AbsoluteConstraints(390, 10, 346, 139));

        btnAssignDriver.setBackground(new java.awt.Color(255, 255, 255));
        btnAssignDriver.setIcon(new javax.swing.ImageIcon(getClass().getResource("/UserInterface/assign_driver.PNG"))); // NOI18N
        btnAssignDriver.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnAssignDriverActionPerformed(evt);
            }
        });
        add(btnAssignDriver, new org.netbeans.lib.awtextra.AbsoluteConstraints(540, 160, 100, 90));

        backJButton.setBackground(new java.awt.Color(255, 255, 255));
        backJButton.setIcon(new javax.swing.ImageIcon("C:\\Users\\vikram\\Desktop\\Captureback.PNG")); // NOI18N
        backJButton.setBorder(null);
        backJButton.setBorderPainted(false);
        backJButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                backJButtonActionPerformed(evt);
            }
        });
        add(backJButton, new org.netbeans.lib.awtextra.AbsoluteConstraints(0, 0, -1, -1));
    }// </editor-fold>//GEN-END:initComponents

    private void v0ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_v0ActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_v0ActionPerformed

    private void v1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_v1ActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_v1ActionPerformed

    private void v2ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_v2ActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_v2ActionPerformed

    private void btnAssignDriverActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnAssignDriverActionPerformed
        int selectedRow = shortestPathTbl.getSelectedRow();
        System.out.println("Intial size of verticesList" + dijkstra.getG().getVertices().size());
        if (selectedRow < 0) {
            JOptionPane.showMessageDialog(null, "Please select a path");
            return;
        }
        LinkedList<Vertex> selectedList = (LinkedList<Vertex>) shortestPathTbl.getValueAt(selectedRow, 0);

        for (Vertex v : selectedList) {
            String btn = v.toString();
            if (btn.equals("v0")) {
                ImageIcon ii = new ImageIcon("C:\\Users\\vikram\\GIT\\AED\\AED Final Project\\Final_ProjectMondayHolla\\src\\UserInterface\\light.PNG");
                v0.setIcon(ii);
            }
            if (btn.equals("v1")) {
                ImageIcon ii = new ImageIcon("C:\\Users\\vikram\\GIT\\AED\\AED Final Project\\Final_ProjectMondayHolla\\src\\UserInterface\\light.PNG");
                v1.setIcon(ii);
            }
            if (btn.equals("v2")) {
                ImageIcon ii = new ImageIcon("C:\\Users\\vikram\\GIT\\AED\\AED Final Project\\Final_ProjectMondayHolla\\src\\UserInterface\\light.PNG");
                v2.setIcon(ii);
            }
            if (btn.equals("v3")) {
                ImageIcon ii = new ImageIcon("C:\\Users\\vikram\\GIT\\AED\\AED Final Project\\Final_ProjectMondayHolla\\src\\UserInterface\\light.PNG");
                v3.setIcon(ii);
            }
            if (btn.equals("v4")) {
                ImageIcon ii = new ImageIcon("C:\\Users\\vikram\\GIT\\AED\\AED Final Project\\Final_ProjectMondayHolla\\src\\UserInterface\\light.PNG");
                v4.setIcon(ii);
            }
            if (!v.toString().equals("v0")) {
                dijkstra.getG().getVertices().remove(v);
                System.out.println("Removed vertices" + v);
            }

        }
        System.out.println("Reduced size of verticesList" + dijkstra.getG().getVertices().size());
        try {

            Graph newG = dijkstra.addGraph(dijkstra.getG());
            dijkstra.calculate(newG.getVertex(0));
            dijkstra.printPath(newG);
            populateTable(newG);

        } catch (Exception ex) {
            System.out.println("Not able to recalculate Dijkstras while assigning driver");

        }

        for (Map.Entry<Integer, LinkedList<Vertex>> entry : driverPathMap.entrySet()) {
            

            System.out.println("Driver id" + entry.getKey());

            System.out.println("Driver path" + entry.getValue());
        }
        
        System.out.println("outside for ");
        //Assigning a driver
        for (UserAccount ua : managementOrganization.getUserAccountDirectory().getUserAccountList()) {

            if (ua.getRole().toString().equals("DriverRole")) {
                DriverRole d = (DriverRole) ua.getRole();

                System.out.println("The driver id--->" + d.getDriverId());

                if (!(driverPathMap.containsKey(d.getDriverId()))) {
                    driverPathMap.put(d.getDriverId(), selectedList);
                    System.out.println("Assigned driver" + d.getDriverId());
                    d.setAssigned(true);
                    break;
                }
            }
        }

        DriverJframe dJ = new DriverJframe(driverPathMap);

        for (Map.Entry<Integer, LinkedList<Vertex>> entry : driverPathMap.entrySet()) {
           

            System.out.println("Driver id" + entry.getKey());

            System.out.println("Driver path" + entry.getValue());
        }
    }//GEN-LAST:event_btnAssignDriverActionPerformed

    private void backJButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_backJButtonActionPerformed
        UserProcessContainer.remove(this);
        CardLayout layout = (CardLayout) UserProcessContainer.getLayout();
        layout.previous(UserProcessContainer);
    }//GEN-LAST:event_backJButtonActionPerformed

    private void populateTable(Graph graphTable) {
        DefaultTableModel model = (DefaultTableModel) shortestPathTbl.getModel();
        model.setRowCount(0);

        for (Vertex v : graphTable.getVertices()) {
            v.path.addLast(v);

            Object[] row = new Object[3];

            row[0] = v.path;

            Set<Vertex> no_Duplicates = new HashSet<>(v.path);

            //   row[1] = v.path.toString();
            row[1] = no_Duplicates;

            row[2] = v.minDistance;

            model.addRow(row);

        }
    }
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton backJButton;
    private javax.swing.JButton btnAssignDriver;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JTable shortestPathTbl;
    private javax.swing.JButton v0;
    private javax.swing.JButton v1;
    private javax.swing.JButton v2;
    private javax.swing.JButton v3;
    private javax.swing.JButton v4;
    // End of variables declaration//GEN-END:variables
}
